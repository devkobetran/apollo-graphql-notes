"use strict";(self.webpackChunkelasticstack_notes=self.webpackChunkelasticstack_notes||[]).push([[6474],{6151:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=n(4848),t=n(8453);const i={sidebar_position:2},a="Resolvers",l={id:"tutorial/Resolvers",title:"Resolvers",description:"Journey of a GraphQL query",source:"@site/docs/tutorial/Resolvers.md",sourceDirName:"tutorial",slug:"/tutorial/Resolvers",permalink:"/apollo-graphql-notes/docs/tutorial/Resolvers",draft:!1,unlisted:!1,editUrl:"https://github.com/devkobetran/apollo-graphql-notes/docs/tutorial/Resolvers.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Basics",permalink:"/apollo-graphql-notes/docs/tutorial/Basics"},next:{title:"Arguments",permalink:"/apollo-graphql-notes/docs/tutorial/Arguments"}},o={},c=[{value:"Journey of a GraphQL query",id:"journey-of-a-graphql-query",level:2},{value:"Client-side",id:"client-side",level:3},{value:"Server-side",id:"server-side",level:3},{value:"Back to Client-side",id:"back-to-client-side",level:3},{value:"Exploring our Data",id:"exploring-our-data",level:2},{value:"Where is our data stored?",id:"where-is-our-data-stored",level:3},{value:"Apollo RESTDataSource",id:"apollo-restdatasource",level:2},{value:"Challenges with caching in GraphQL",id:"challenges-with-caching-in-graphql",level:3},{value:"Solution with caching in GraphQL",id:"solution-with-caching-in-graphql",level:3},{value:"Benefits of a Resource cache",id:"benefits-of-a-resource-cache",level:3},{value:"Implementing Our RESTDataSource",id:"implementing-our-restdatasource",level:2},{value:"The shape of a resolver",id:"the-shape-of-a-resolver",level:2},{value:"How do resolvers interact with the data source",id:"how-do-resolvers-interact-with-the-data-source",level:3},{value:"Implementing query resolvers",id:"implementing-query-resolvers",level:2},{value:"Connecting the dots in server-land",id:"connecting-the-dots-in-server-land",level:2},{value:"Querying live data",id:"querying-live-data",level:2},{value:"Codegen on the server",id:"codegen-on-the-server",level:2},{value:"Errors! When something goes wrong",id:"errors-when-something-goes-wrong",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"resolvers",children:"Resolvers"})}),"\n",(0,s.jsx)(r.h2,{id:"journey-of-a-graphql-query",children:"Journey of a GraphQL query"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/01-journey-of-a-graphql-query",children:"Journey of a GraphQL Query"})}),"\n",(0,s.jsx)(r.h3,{id:"client-side",children:"Client-side"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["A client sends queries to the GraphQL Server by:","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"shaping the query as a string that defines the selection set of fields it needs."}),"\n",(0,s.jsxs)(r.li,{children:["Then, it sends that query to the server in an HTTP ",(0,s.jsx)(r.code,{children:"POST"})," or ",(0,s.jsx)(r.code,{children:"GET"})," request."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"server-side",children:"Server-side"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["When our server receives the HTTP request, it extracts the string with the GraphQL query.","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"It parses and transforms it into an AST."}),"\n",(0,s.jsxs)(r.li,{children:["An ",(0,s.jsx)(r.strong,{children:"AST (Abstract Syntax Tree)"})," is a tree-structured document."]}),"\n",(0,s.jsx)(r.li,{children:"With this AST, the server validates the query against the types and fields in our schema."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.admonition,{type:"warning",children:(0,s.jsx)(r.p,{children:"If anything is off (e.g. a requested field is not defined in the schema or the query is malformed), the server throws an error and sends it right back to the app."})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:'A resolver function\'s mission is to "resolve" its field by populating it with the correct data from the correct source, such as a database or a REST API.'}),"\n",(0,s.jsxs)(r.li,{children:["When a query executes successfully, a ",(0,s.jsx)(r.code,{children:"data"})," key containing a result object with the same shape as the query is returned by the GraphQL server."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"back-to-client-side",children:"Back to Client-side"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Our client receives the response with exactly the data it needs and passes that data to the right components to render them."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"exploring-our-data",children:"Exploring our Data"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/02-exploring-our-data",children:"Exploring our Data tutorial"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["The data that resolvers retrieve can come from ",(0,s.jsx)(r.strong,{children:"data sources"}),":","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"a database,"}),"\n",(0,s.jsx)(r.li,{children:"a third-party API,"}),"\n",(0,s.jsx)(r.li,{children:"webhooks,"}),"\n",(0,s.jsx)(r.li,{children:"etc."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.li,{children:"A single GraphQL API can connect to multiple data sources."}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"where-is-our-data-stored",children:"Where is our data stored?"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://odyssey-lift-off-rest-api.herokuapp.com/?_gl=1*vcarxk*_ga*MTg0Mjk4NTE0NS4xNzI5MTMwMzEx*_ga_0BGG5V2W2K*MTcyOTUyNTI2Ny4xMy4wLjE3Mjk1MjUyNjcuMC4wLjA",children:"https://odyssey-lift-off-rest-api.herokuapp.com/?_gl=1*vcarxk*_ga*MTg0Mjk4NTE0NS4xNzI5MTMwMzEx*_ga_0BGG5V2W2K*MTcyOTUyNTI2Ny4xMy4wLjE3Mjk1MjUyNjcuMC4wLjA"})}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"apollo-restdatasource",children:"Apollo RESTDataSource"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["How to access the data from our resolvers?","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"GraphQL Server needs to access the REST API."}),"\n",(0,s.jsxs)(r.li,{children:["Could call API directly using ",(0,s.jsx)(r.code,{children:"fetch"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Use a helper class called ",(0,s.jsx)(r.code,{children:"DataSource"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.admonition,{type:"warning",children:[(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"N + 1 Problem"})}),(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:'"1" refers to the call to fetch the top-level field'}),"\n",(0,s.jsx)(r.li,{children:'"N" is the number of subsequent calls to fetch the subfield for each track.'}),"\n",(0,s.jsxs)(r.li,{children:["This problem is inefficient because making N calls to the exact same endpoint retrieves the exact same data.","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"This could be done with 2 calls."}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["If the page doesn't change often, could use a cache to avoid unnecessary calls to the REST API.","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Could design the REST API to set cache headers for its endpoints."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"challenges-with-caching-in-graphql",children:"Challenges with caching in GraphQL"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Challenge"}),": With GraphQL, one query is often composed of a mix of different fields and types, coming from different endpoints, with different cache policies."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"solution-with-caching-in-graphql",children:"Solution with caching in GraphQL"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Instead of being limited by a ",(0,s.jsx)(r.code,{children:"fetch"})," approach, Apollo provides a GraphQL dedicated ",(0,s.jsx)(r.code,{children:"DataSource"})," class called ",(0,s.jsx)(r.code,{children:"RESTDataSource"})," that will efficiently handle resource caching and deduplication for the REST API calls."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"benefits-of-a-resource-cache",children:"Benefits of a Resource cache"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["A resource cache is useful for a data source because:","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"It helps manage the mix of different endpoints with different cache policies."}),"\n",(0,s.jsx)(r.li,{children:"It prevents unnecessary REST API calls for data that doesn't get updated frequently."}),"\n",(0,s.jsx)(r.li,{children:"It helps resolve query fields that have already been fetched much faster."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"implementing-our-restdatasource",children:"Implementing Our RESTDataSource"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/04-implementing-our-restdatasource",children:"Implementing our RESTDataSource Tutorial"})}),"\n",(0,s.jsx)(r.p,{children:"e.g."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'export class TrackAPI extends RESTDataSource {\n  baseURL = "https://odyssey-lift-off-rest-api.herokuapp.com/";\n}\n'})}),"\n",(0,s.jsx)(r.admonition,{type:"note",children:(0,s.jsxs)(r.p,{children:["Be sure that your ",(0,s.jsx)(r.code,{children:"TrackAPI"})," class' ",(0,s.jsx)(r.code,{children:"baseURL"})," value ends with a ",(0,s.jsx)(r.code,{children:"/"}),". This will allow our helper class to make requests and append new paths to the ",(0,s.jsx)(r.code,{children:"baseURL"})," without any errors."]})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"server/src/datasources/track-api.ts"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { RESTDataSource } from "@apollo/datasource-rest";\n\nexport class TrackAPI extends RESTDataSource {\n  baseURL = "https://odyssey-lift-off-rest-api.herokuapp.com/";\n\n  getTracksForHome() {\n    return this.get("tracks");\n  }\n\n  getAuthor(authorId: string) {\n    return this.get(`author/${authorId}`);\n  }\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"the-shape-of-a-resolver",children:"The shape of a resolver"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/05-the-shape-of-a-resolver",children:"The shape of a resolver"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"A resolver's mission is to populate the data for a field in your schema. Your mission is to implement those resolvers!"}),"\n",(0,s.jsxs)(r.li,{children:["A resolver is a function.","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"It is responsible for populating the data for a single field in your schema."}),"\n",(0,s.jsx)(r.li,{children:"It has the same name as the field that it populates data for."}),"\n",(0,s.jsx)(r.li,{children:"It can fetch data from any data source, then transforms that data into the shape your client requires."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Query: {\n  // returns an array of Tracks that will be used to populate\n  // the homepage grid of our web client\n  tracksForHome: () => {},\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"how-do-resolvers-interact-with-the-data-source",children:"How do resolvers interact with the data source"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Resolver functions have a specific signature with four optional parameters: parent, args, contextValue, and info.","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"parent"})," is the returned value of the resolver for this field's parent. This will be useful when dealing with resolver chains."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"args"})," is an object that contains all GraphQL arguments that were provided for the field by the GraphQL operation. When querying for a specific item (such as a specific track instead of all tracks), in client-land we'll make a query with an ",(0,s.jsx)(r.code,{children:"id"})," argument that will be accessible via this ",(0,s.jsx)(r.code,{children:"args"})," parameter in server-land."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"contextValue"})," is an object shared across all resolvers that are executing for a particular operation. The resolver needs this argument to share state, like authentication information, a database connection, or in our case the RESTDataSource."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"info"})," contains information about the operation's execution state, including the field name, the path to the field from the root, and more. It's not used as frequently as the others, but it can be useful for more advanced actions like setting cache policies at the resolver level."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"implementing-query-resolvers",children:"Implementing query resolvers"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/06-implementing-query-resolvers",children:"Implementing query resolvers"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Destructuring Example"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"export const resolvers = {\n  Query: {\n    // get all tracks, will be used to populate the homepage grid of our web client\n    tracksForHome: (_, __, { dataSources }) => {\n      return dataSources.trackAPI.getTracksForHome();\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"note",children:(0,s.jsx)(r.p,{children:"Our tracksForHome resolver will return the results from that TrackAPI method."})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsxs)(r.strong,{children:[(0,s.jsx)(r.code,{children:"Parent"})," in argument Example"]}),":\n",(0,s.jsx)(r.strong,{children:"server/src/resolvers.ts"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export const resolvers = {\n  Query: {\n    // get all tracks, will be used to populate the homepage grid of our web client\n    tracksForHome: (_, __, { dataSources }) => {\n      return dataSources.trackAPI.getTracksForHome();\n    },\n  },\n  Track: {\n    author: ({ authorId }, _, { dataSources }) => {\n      return dataSources.trackAPI.getAuthor(authorId);\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(r.h2,{id:"connecting-the-dots-in-server-land",children:"Connecting the dots in server-land"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/07-connecting-the-dots-in-server-land",children:"Connecting the dots in server-land"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["A ",(0,s.jsx)(r.code,{children:"dataSources"})," object needs to be returned from the server's ",(0,s.jsx)(r.code,{children:"context"})," function in order to gain access to our data sources from each resolver's ",(0,s.jsx)(r.code,{children:"contextValue"})," parameter."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"querying-live-data",children:"Querying live data"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/08-querying-live-data",children:"Querying live data"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Query using ",(0,s.jsx)(r.code,{children:"RESTDataSource"})," vs Query using ",(0,s.jsx)(r.code,{children:"fetch"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Due to caching in the ",(0,s.jsx)(r.code,{children:"RESTDataSource"})," approach, results are returned faster after the first query."]}),"\n",(0,s.jsx)(r.li,{children:"Different resolvers can use different methods to access the same REST API."}),"\n",(0,s.jsx)(r.li,{children:"You will get the same response data with both approaches."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"codegen-on-the-server",children:"Codegen on the server"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/08-server-codegen",children:"Codegen on the server"})}),"\n",(0,s.jsx)(r.h2,{id:"errors-when-something-goes-wrong",children:"Errors! When something goes wrong"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.apollographql.com/tutorials/lift-off-part2/09-errors-when-queries-go-sideways",children:"Errors! When something goes wrong"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Within a server response, the ",(0,s.jsx)(r.code,{children:"data"})," key or the ",(0,s.jsx)(r.code,{children:"errors"})," key can be expected in the JSON object."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"GRAPHQL_VALIDATION_FAILED"})," error code means the GraphQL operation is not valid against the server's schema. Either a field isn't defined, or you might have a typo somewhere in your query!"]}),"\n"]})]})}function d(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var s=n(6540);const t={},i=s.createContext(t);function a(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);